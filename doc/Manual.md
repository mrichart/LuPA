LuPA and Rmoon reference
===

Syntax:
    lua lupa.lua [config_file]

Where config file is an optional configuration file. It will start all the services,
but it’s also possible to run sepparatelly the following services:

* lupa/pep.lua: Policy Enforcement Point.
* lupa/pdp.lua: Policy Decission Point.
* lupa/rmoon.lua: Monitoring Service

## Networking

A LuPA instance must be connected to a Rnr server, specified as the **upstream**
attribute in the configuration. Rnr must be properly set-up to insure connectivity.

## Configuration File

The configuration file is a Lua script which is executed at service start-up time.
It is used to set configuration variables.

The accesable variables are:

**my\_name\_pdp** Identifier for the the pdp service. If omited an autogenerated
id is used.

**my\_name\_pep** Identifier for the the pep service. If omited an autogenerated
id is used.

**my\_name\_rmoon** Identifier for the the rmoon service. If omited an autogen-
erated id is used.

**time\_step** By default 1.

**trap\_generation\_interval** Interval between trap creation evaluations (for rmoon),
in seconds. Default is 3.

**pdp\_evaluation\_interval** Interval for policy re-avaluation (for pdp), in sec-
onds. Default is 5.

**upstream** Addresses for rnr server to connect. By default is {”127.0.0.1”,
8182}.

**sleep\_on\_reconnect** Time to wait before attempting a re-connection to the up-
stream router, in seconds. By dafualt is 5.

## Messages

Lupa services are accesed trough rnr router’s NOTIFICATION messages. An
additional message **type** field is defined. A **action**-type notification is sent to
the service, who answers a with a **response**- type notification. If the action
activated a watcher, the service will start issuing **trap** notifications.

### Action messages

In addition to the fields specified for NOTIFICATION messages, the following
fields are defined:

**message\_type=action** (Mandatory) Indicates the type of message

**target** (Optional) This field is used to identify the targeted service instance.
Lupa services subscribe to notifications with target equal theyr own id.

**command** (Mandatory) Identifies the action to execute. (For the full list of
available commands and theyr parameters, refer to section Command)

Example


    NOTIFICATION
    notification id=cmndid
    source=client1
    timestamp=1234
    target=pep1
    message type=action
    command=get mib
    mib=iface has ipv4
    ifname=eth0
    END

### Response messages

Message that contains the response to an action, generated by lupa/pep. Besides
the fields specified for NOTIFICATION messages, the following are used:

**message\_type=response** (Mandatory) Indicates the type of message

**target** (Mandatory) Indicates to whom the answer is targeted. It’s taken from
the **source** field of the original command.

**reply\_to** (Mandatory) Identifies the action being answered. Is taken from from
**notification_id** field of the original command.

Additionally there are fields which contain the specific response to the command.
The full list refer to section Command.

Example response to the previous message:

    NOTIFICATION
    notification id=resp01
    source=pep1
    timestamp=12345
    target=client1
    message type=response
    reply to=cmndid
    value=true
    END

### Trap message

These are generated by rmoon, triggered by a watcher (see action 3.3.1 watch mib).
Besides the fields specified for NOTIFICATION messages, the following are
used:

**message\_type=trap** (Mandatory) Indicates the type of message.

**target** (Mandatory) Indicates to whom the trap is targeted. It’s taken from
the **source** field of the command that created the watcher.

**watcher\_id** (Mandatory) Identifies the watcher that triggered the trap.

**mib** (Mandatory) The name of the variable.

**value** (Mandatory) Value of the variable

## Command

The commands must be sent to the right service (pep, pdp o rmoon). The available
command for action notifications and their responses are, by service:

TODO

### PEP

### PDP

### Rmoon



